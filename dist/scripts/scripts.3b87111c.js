"use strict";angular.module("asbuiltsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","autocomplete","leaflet-directive","ngDragDrop"]).value("projectConstants",{version:.1,documentBaseUrl:"http://gis.raleighnc.gov/asbuilts/PROJECT_TRACKING/"}).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/form.html",controller:"FormCtrl"}).when("/instructions",{templateUrl:"views/instructions.html"}).when("/form",{templateUrl:"views/form.html",controller:"FormCtrl"}).when("/stats",{templateUrl:"views/stats.html",controller:"StatsCtrl"}).when("/map",{templateUrl:"views/map.html",controller:"MapCtrl"}).when("/document/:documentid",{templateUrl:"views/documents.html",controller:"DocCtrl"}).when("/error",{templateUrl:"404.html"}).otherwise({redirectTo:"/error"}),b.defaults.useXDomain=!0,delete b.defaults.headers.common["X-Requested-With"]}]),angular.module("asbuiltsApp").service("ags",["$resource",function(a){var b="http://:name.raleighnc.gov/arcgis/rest/services/PublicUtility/:folder/:serviceType";this.AgsLayers=function(a){this.items=a},this.AgsLayers.prototype.getLayerId=function(a){for(var b=0,c=this.items.length;c>b;b++)if(this.items[b].name===a)return this.items[b].id},this.paramDefaults={test:{name:"mapstest",folder:"ProjectTracking",serviceType:"FeatureServer"},fs:{name:"mapstest",id:"0",folder:"ProjectTracking",serviceType:"FeatureServer"}};var c=function(){this.actions={}};c.prototype={Type:function(a,b,c,d){this.method=a,this.timeout=b||5e3,this.params=c,this.cache=d||!1},setAction:function(a,b,c,d,e){var f=new this.Type(b,c,d,e);this.actions[a]=f}};var d=new c;d.setAction("getService","GET",5e3,{f:"json"},!0),d.setAction("getAll","GET",5e3,{f:"json",outFields:"*",where:"OBJECTID > 0",returnGeometry:!1},!0),d.setAction("deleteFeature","POST",5e3,{f:"json",objectIds:null},!1),this.testServer=a(b,this.paramDefaults.test,d.actions),this.features=a(b+"/:id/query",this.paramDefaults.fs,d.actions),this.deleteFeatures=a(b+"/deleteFeatures",this.paramDefaults.fs,d.actions)}]),angular.module("asbuiltsApp").factory("OptionsFactory",[function(){var a=function(a,b,c,d,e){this.f=a||"json",this.outFields=b||"*",this.where=c||"OBJECTID > 0",this.orderByFields=d||null,this.returnGeometry=e||"false"};return a.prototype={getOptions:function(){return this},updateOptions:function(a,b){Object.keys(this).indexOf(a)>-1?this[a]=b:this},addOptions:function(a,b){this[a]=b},removeOptions:function(a){delete this[a]}},a}]),angular.module("asbuiltsApp").service("ProjectSearch",["ags","OptionsFactory","$filter",function(a,b){{var c=new b("json","*","","PROJECTNAME ASC",!1);a.testServer.getService({serviceType:"MapServer"}).$promise.then(function(b){var d=new a.AgsLayers(b.layers.concat(b.tables));c.addOptions("id",d.getLayerId("Project Tracking"))})}return{autoFillProjects:function(b){function d(a){for(var b=[],c=0,d=a.length;d>c;c++)b.indexOf(b[c])?a:b.push(this[c]);return b}var e=[];return c.addOptions("text",b.toUpperCase()),c.addOptions("serviceType","MapServer"),a.features.getAll(c).$promise.then(function(a){try{if(a.features.length>0){for(var b=0,c=a.features.length;c>b;b++)e.push(a.features[b].attributes.PROJECTNAME+":"+a.features[b].attributes.DEVPLANID+":"+a.features[b].attributes.PROJECTID);d(e)}else e.push("Sorry No Record Found...")}catch(f){console.log(f)}}),e}}}]),angular.module("asbuiltsApp").controller("HeaderController",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("asbuiltsApp").controller("StatsCtrl",["$scope","$http","$timeout","Options","ags",function(a,b,c,d,e){e.testServer.getService().$promise.then(function(b){a.layers=new e.Layers(b.layers.concat(b.tables));var c=new d("json","*","DEVPLANID = 'GH-5-2011'","PROJECTNAME ASC","true");c.addOptions("id",a.layers.getLayerId("Project Tracking"));var f=e.features.getAll(c);console.log(f)})}]),angular.module("asbuiltsApp").controller("MapCtrl",["$scope","$http","$filter","$sce","leafletData","ProjectSearch","projectConstants",function(a,b,c,d,e,f,g){function h(a){return a.reduce(function(b,c){return[b[0]+c[0]/a.length,b[1]+c[1]/a.length]},[0,0])}function i(b,c){a.viewData=b,c.bindPopup("<h4>PROJECT NAME:"+b.properties.PROJECTNAME+"</h4>"),c.on("mouseover",function(){a.viewData=b.properties,c.setStyle(k.paidStyle),m(a.centroid)}),c.on("mouseout",function(){c.setStyle(k.expiredStyle)})}function j(a){for(var b in a)a[b]?a[b]:delete a[b]}a.searchStatus=!1,angular.extend(a,{center:{lat:35.843768,lng:-78.6450559,zoom:13},layers:{baselayers:{xyz:{name:"OpenStreetMap (XYZ)",url:"https://{s}.tiles.mapbox.com/v3/examples.3hqcl3di/{z}/{x}/{y}.png",type:"xyz"},raleigh:{name:"Basic Base Map",type:"dynamic",url:"http://maps.raleighnc.gov/arcgis/rest/services/BaseMap/MapServer",visible:!1,layerOptions:{layers:["*"],opacity:1,attribution:"Copyright:© 2014 City of Raleigh"}}},overlays:{projects:{name:"Project Tracking",type:"dynamic",url:"http://mapstest.raleighnc.gov/arcgis/rest/services/PublicUtility/ProjectTracking/MapServer",visible:!1,layerOptions:{layers:[2],opacity:.5,attribution:"Copyright:© 2014 City of Raleigh"}},sewer:{name:"Sewer Collection Network",type:"dynamic",url:"http://maps.raleighnc.gov/arcgis/rest/services/PublicUtility/SewerExternal/MapServer",visible:!1,layerOptions:{layers:[0,1,2,3,4],opacity:1,attribution:"Copyright:© 2014 City of Raleigh"}},water:{name:"Water Distribution Network",type:"dynamic",url:"http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/WaterDistribution/MapServer",visible:!1,layerOptions:{layers:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],opacity:1,attribution:"Copyright:© 2014 City of Raleigh"}},reuse:{name:"Reuse Distribution Network",type:"dynamic",url:"http://gis.raleighnc.gov/arcgis/rest/services/PublicUtility/ReclaimedDistribution/MapServer",visible:!1,layerOptions:{layers:[0,1,2,3,4,5,6,7,8,9,10,11],opacity:1,attribution:"Copyright:© 2014 City of Raleigh"}}}},legend:{position:"bottomleft",colors:["#FFF","#28c9ff","#0000ff","#ecf386","#28c9ff","#0000ff","#FFF"],labels:['<img src="../images/ab.png" height="20px" width="20px" /> AS-Built','<img src="../images/cp.png" height="20px" width="20px" /> Construction Plan','<img src="../images/al.png" height="20px" width="20px" /> Acceptance Letter','<img src="../images/wl.png" height="20px" width="20px" /> Warranty Letter','<img src="../images/soc.png" height="20px" width="20px" /> Statement of Cost','<img src="../images/p.png" height="20px" width="20px" /> Permits','<img src="../images/plat.png" height="20px" width="20px" /> Plats']}});var k={paidStyle:{fillColor:"#aa3939",radius:5,color:"#550000",weight:1,fillOpacity:.7},expiredStyle:{fillColor:"rgba(247,247,247, 0.1)",weight:5,opacity:1,color:"rgb(252,141,89)",dashArray:"3",fillOpacity:.7},hoverStyle:{fillColor:"#0ab25d",radius:5,color:"#0ab25d",weight:1,fillOpacity:.7}},l=[{name:"ASBUILTS",message:"As-Built",icon:{iconUrl:"../images/ab.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[5,5]}},{name:"CONSTUCTION_PLAN",message:"Construction Plan",icon:{iconUrl:"../images/cp.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[5,0]}},{name:"ACCEPTANCE_LETTER",message:"Acceptance Letter",icon:{iconUrl:"../images/al.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[-5,5]}},{name:"WARRANTY_LETTER",message:"Warranty Letter",icon:{iconUrl:"../images/wl.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[5,-5]}},{name:"STATEMENT_OF_COST",message:"Statement of Cost",icon:{iconUrl:"../images/soc.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[-5,0]}},{name:"PERMITS",message:"Permit",icon:{iconUrl:"../images/p.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[-5,-5]}},{name:"Plat",message:"Plat",icon:{iconUrl:"../images/plat.png",iconSize:[38,38],iconAnchor:[0,0],popupAnchor:[-5,-5]}}],m=function(b){b={lat:b[0],lng:b[1]};var c=[{lat:b.lat+.001,lng:b.lng+.001},{lat:b.lat,lng:b.lng+.002},{lat:b.lat+.001,lng:b.lng-.001},{lat:b.lat-.001,lng:b.lng+.001},{lat:b.lat,lng:b.lng-.002},{lat:b.lat-.001,lng:b.lng-.001},{lat:b.lat+.001,lng:b.lng-.0015}];angular.extend(a,{markers:{},paths:{}});for(var d in l){var e=l[d].name;a.markers[e]=c[d],a.markers[e].draggable=!0,a.markers[e].icon=l[d].icon,a.markers[e].message=l[d].message}};a.autoFillProjects=function(b){a.searchStatus=!1,a.project_docs=!1,a.projects=f.autoFillProjects(b)},a.searchControl=function(f){console.log(f);var k=f.split(":"),l={f:"json",outFields:"*",where:"PROJECTID =  '"+k[2]+"'",outSR:4326,returnGeometry:!0},m="http://mapstest.raleighnc.gov/arcgis/rest/services/PublicUtility/ProjectTracking/FeatureServer/2/query",n="http://mapstest.raleighnc.gov/arcgis/rest/services/PublicUtility/ProjectTracking/FeatureServer/5/query";b.get(m,{params:l,cache:!0}).success(function(b){e.getMap().then(function(d){a.project_info=b.features[0].attributes,a.project_info.CREATEDON=c("date")(a.project_info.CREATEDON,"MM/dd/yyyy"),a.project_info.DEVPLAN_APPROVAL=c("date")(a.project_info.DEVPLAN_APPROVAL,"MM/dd/yyyy"),a.project_info.EDITEDON=c("date")(a.project_info.EDITEDON,"MM/dd/yyyy"),j(a.project_info);var e=[];a.poly=[],a.bound=[];for(var f in b.features[0].geometry.rings[0]){var g=b.features[0].geometry.rings[0][f],k=b.features[0].geometry.rings;for(var l in g)e.push([g[1],g[0]]),a.poly.push(k),a.bound.push({lat:g[1],lng:g[0]})}a.mygeojson={type:"FeatureCollection",features:[{type:"Feature",id:b.features[0].attributes.PROJECTID,properties:b.features[0].attributes,geometry:{type:"MultiPolygon",coordinates:a.poly}}]},console.log(a.mygeojson),angular.extend(a,{geojson:{data:a.mygeojson,style:{fillColor:"rgba(252,141,0, 0.1)",weight:2,opacity:1,color:"rgb(252,141,89)",dashArray:"4",fillOpacity:.7},onEachFeature:i,resetStyleOnMouseout:!0}}),a.centroid=h(e),d.fitBounds(e),a.searchStatus=!0})}),b.get(n,{params:l,cache:!0}).success(function(b){console.log(b.features),a.project_docs=b.features.map(function(a){var b={url:d.trustAsResourceUrl(g.documentBaseUrl+a.attributes.PROJECTID+"/"+a.attributes.PROJECTID+"-"+a.attributes.DOCTYPEID+"-"+a.attributes.DOCID+".pdf"),name:a.attributes.PROJECTID+"-"+a.attributes.DOCTYPEID+"-"+a.attributes.DOCID,resid:a.attributes.PROJECTID+"-"+a.attributes.DOCTYPEID+"-"+a.attributes.DOCID+"res",icon:"../images/"+a.attributes.DOCTYPEID.toLowerCase()+".png"};return b});for(var c in a.project_docs){var e="#"+a.project_docs[c].resid;$(e).resizable()}})},a.list1={title:"AngularJS - Drag Me"};var n="http://mapstest.raleighnc.gov/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task/execute";a.dpi=90,a.print_format="PDF",a.exportSizes=[{size:[500,500]},{size:[700,500]},{size:[700,1e3]}],a.printFormatList=["PDF","PNG8","PNG32","JPG","GIF","EPS","SVG","SVGZ"];var o={mapOptions:{},operationalLayers:[],baseMap:[{title:"Basemap",baseMapLayers:[{url:"http://maps.raleighnc.gov/arcgis/rest/services/BaseMap/MapServer",opacity:1}]}],exportOptions:{dpi:a.dpi,outputSize:[700,500]||a.output}};e.getMap().then(function(b){b.on("move",function(){a.mapbounds=b.getBounds(),o.mapOptions.extent={xmin:a.mapbounds._southWest.lat,ymin:a.mapbounds._southWest.lng,xmax:a.mapbounds._northEast.lat,ymax:a.mapbounds._northEast.lng},o.operationalLayers=[],b.eachLayer(function(a){b.hasLayer(a)?o.operationalLayers.push({url:a.url}):console.log("No layers added to print")})});var c=L.control({position:"bottomright"});c.onAdd=function(){var a=L.DomUtil.create("div","info legend");return a.innerHTML='<button class="btn btn-primary btn-sm mapPrint" data-toggle="modal" data-target="#myModal">Print</button>',a},c.addTo(b)}),a.print_params={Web_Map_as_JSON:o,format:a.print_format,Layout_Template:"MAP_ONLY",f:"json"},a.$watch("print_params",function(){},!0),a.printMap=function(){b.get(n,{params:a.print_params,headers:{"Content-Type":"text/plain"}}).success(function(a){console.log(a)})}}]),angular.module("asbuiltsApp").controller("FormCtrl",["$scope","$http","$filter",function(a,b,c){function d(b,c){for(var d in a.servers[0].test.layers)for(var e in a.servers[0].test.layers[d])if(a.servers[0].test.layers[d][e].name===b){var f=a.servers[0].test.FeatureServer+"/"+a.servers[0].test.layers[d][e].id+"/"+c;return f}}function e(a,b,c,d){for(var e in a)for(var f in b)a[e].attributes[c]===b[f].attributes[c]&&(a[e].attributes[d]=b[f].attributes[d])}function f(a){var b=[];for(var c in a)b.push(a[c].attributes.DOCID);return b.sort(function(a,b){return b-a}),b[0]}function g(b){for(var c in a.sheets)1===a.sheets[c].attributes[b]?a.sheets[c].attributes[b]="True":0===a.sheets[c].attributes[b]&&(a.sheets[c].attributes[b]="False")}a.pageControls={continueButton:!1,deleteLastRecord:!1,table:!1,noRecords:!1},a.fields=null,a.projects=null,a.formSuccess=!1,a.selections=[{name:!0,id:1},{name:!1,id:0}],a.selectionOptions={project:"--Please Select Project--",doctype:"--Please Select Document Type--",engineer:"--Please Select Engineering Firm--",tf:"--Please Select--",sheet:"--Please Select Sheet--"};var h=0;a.servers=[{test:{FeatureServer:"http://mapstest.raleighnc.gov/arcgis/rest/services/PublicUtility/ProjectTracking/FeatureServer",layers:[]}},{WAKE:{Addresses:"http://maps.raleighnc.gov/arcgis/rest/services/Addresses/MapServer/0/query"}}];var i=function(c,d,e){var f={f:"json",outFields:"*",where:"OBJECTID >"+c,orderByFields:d+" ASC",returnGeometry:!1};for(var g in a.servers[0].test.layers)for(var h in a.servers[0].test.layers[g])if(a.servers[0].test.layers[g][h].name===e){var i=a.servers[0].test.FeatureServer+"/"+a.servers[0].test.layers[g][h].id+"/query";b.get(i,{params:f,cache:!0}).success(function(b){if("RPUD.ENGINEERINGFIRM"===e&&(a.engfirms=b.features),"Project Tracking"===e){a.projects=b.features,a.projectnames=[];for(var c in a.projects)a.projectnames.push(a.projects[c].attributes.PROJECTNAME+":"+a.projects[c].attributes.DEVPLANID+":"+a.projects[c].attributes.PROJECTID)}"RPUD.PTK_DOCUMENTS"===e&&(a.fields=b.fields),"RPUD.SHEETTYPES"===e&&(a.sheetdisc=b.features),"RPUD.DOCUMENTTYPES"===e&&(a.doctypes=b.features)})}};b.get(a.servers[0].test.FeatureServer,{params:{f:"json"},cache:!0}).success(function(b){a.servers[0].test.layers.push(b.layers),a.servers[0].test.layers.push(b.tables),setTimeout(function(){i(h,"OBJECTID","RPUD.PTK_DOCUMENTS"),i(h,"PROJECTNAME","Project Tracking"),i(h,"SIMPLIFIEDNAME","RPUD.ENGINEERINGFIRM"),i(h,"SHEETTYPE","RPUD.SHEETTYPES"),i(h,"DOCUMENTTYPE","RPUD.DOCUMENTTYPES")},1e3)}),a.change=function(h){var i=h.split(":");a.form.PROJECTID=parseInt(i[2]),a.form.DEVPLANID=i[1],a.form.PROJECTNAME=i[0];var j=["SEALDATE","SEALNUMBER","ENGID","FORMERNAME","ALIAS"],k={f:"json",outFields:"*",where:"PROJECTID =  '"+i[2]+"'",orderByFields:"DOCID ASC",returnGeometry:!1},l=d("RPUD.PTK_DOCUMENTS","query");b.get(l,{params:k}).success(function(b){if(console.log(b),a.sheets=b.features,e(a.sheets,a.doctypes,"DOCTYPEID","DOCUMENTTYPE"),e(a.sheets,a.sheetdisc,"SHEETTYPEID","SHEETTYPE"),e(a.sheets,a.engfirms,"ENGID","SIMPLIFIEDNAME"),g("WATER"),g("SEWER"),g("REUSE"),g("STORM"),a.sheetFields=b.fields,0===a.sheets.length){a.pageControls.table=!1,a.pageControls.noRecords=!0;for(var d in j)a.form[j[d]]=null;a.form.DOCID=1}else{a.pageControls.table=!0,a.pageControls.noRecords=!1,a.form.DOCID=f(a.sheets)+1;for(var d in j)a.form[j[d]]=a.sheets[0].attributes[j[d]],a.form.SEALDATE=c("date")(a.sheets[0].attributes.SEALDATE,"yyyy-MM-dd"),a.selectionOptions.engineer=a.sheets[0].attributes.SIMPLIFIEDNAME}})},a.autoFill=function(c){var d={f:"json",outFields:"ADDRESS",text:c,returnGeometry:!1,orderByFields:"ADDRESS ASC"},e=a.servers[1].WAKE.Addresses;b.get(e,{params:d,cache:!0}).success(function(b){console.log(b),a.streets=[];for(var c in b.features){var d=b.features[c].attributes.ADDRESS.replace(/[0-9]/g,"");-1===a.streets.indexOf(d)&&a.streets.push(d)}})},a.nextSheet=function(){a.selectionOptions.project=a.entry.PROJECTNAME,a.pageControls.table=!0;var b=c("date")(a.lastDate,"yyyy-MM-dd");console.log(b),a.form={PROJECTNAME:a.entry.PROJECTNAME,SEALDATE:b,SEALNUMBER:a.entry.SEALNUMBER,DOCID:a.entry.DOCID+1,DEVPLANID:a.entry.DEVPLANID,JURISDICTION:a.entry.JURISDICTION,PROJECTID:a.entry.PROJECTID}},a.delete=function(){var c=d("RPUD.PTK_DOCUMENTS","deleteFeatures");b.post(c,a.postResults,{params:{f:"json",objectIds:a.postResults.objectId},headers:{"Content-Type":"text/plain"}}).success(function(b){console.log(b),a.form.DOCID===a.entry.DOCID+1&&(a.form.DOCID=a.entry.DOCID),a.sheets.pop()}),0===a.sheets.length&&(a.pageControls.table=!1,a.pageControls.noRecords=!0,a.sheets=[])},a.submit=function(c){if(-1!==c.SEALDATE.indexOf("-")){a.lastDate=c.SEALDATE;var e=c.SEALDATE.split("-");a.lastDate=e[1]+"/"+e[2]+"/"+e[0]}var f={PROJECTNAME:c.PROJECTNAME,SEALDATE:a.lastDate,SEALNUMBER:c.SEALNUMBER,DOCTYPEID:c.DOCTYPEID.attributes.DOCTYPEID,DOCID:c.DOCID,ENGID:c.ENGID.attributes.ENGID,WATER:c.WATER.id,SEWER:c.SEWER.id,REUSE:c.REUSE.id,STORM:c.STORM.id,FORMERNAME:c.FORMERNAME||null,ALIAS:c.ALIAS||null,DEVPLANID:c.DEVPLANID,STREET_1:c.STREET_1||null,STREET_2:c.STREET_2||null,STREET_3:c.STREET_3||null,STREET_4:c.STREET_4||null,NOTES:c.NOTES||null,TAGS:c.TAGS||null,PROJECTID:c.PROJECTID,SHEETTYPEID:c.SHEETTYPEID.attributes.SHEETTYPEID};a.pageControls.table=!1,a.entry=f,a.entry.SIMPLIFIEDNAME=c.ENGID.attributes.SIMPLIFIEDNAME;var g=[{attributes:f}],h=angular.toJson(g),i={params:{f:"json",features:h},headers:{"Content-Type":"text/plain"}},j=d("RPUD.PTK_DOCUMENTS","addFeatures");b.post(j,f,i).success(function(b){console.log(b),a.form.$setPristine(),a.form={},a.postResults=b.addResults[0],a.sheets.push({attributes:f})}),a.pageControls.deleteLastRecord=!0,a.pageControls.continueButton=!0},a.over,a.tableEdits={edit:{cell:function(c,d){var e={};e.OBJECTID=c,e[d]=a.table[d];var f=[{attributes:e}],g=angular.toJson(f),h={params:{f:"json",features:g},headers:{"Content-Type":"text/plain"}};b.post(a.servers[0].test.FeatureServer+"/"+a.servers[0].test.tables[0].id+"/updateFeatures",e,h).success(function(a){console.log(a)})}},"delete":{row:function(c){var e=d("RPUD.PTK_DOCUMENTS","deleteFeatures");b.post(e,a.postResults,{params:{f:"json",objectIds:c},headers:{"Content-Type":"text/plain"}}).success(function(b){console.log(b);for(var d in a.sheets)a.sheets[d].attributes.OBJECTID===c&&(console.log(d),a.sheets.splice(d,1))}),0===a.sheets.length&&(a.pageControls.noRecords=!0,a.pageControls.table=!1)}}}}]),angular.module("asbuiltsApp").controller("DocCtrl",["$scope","$routeParams","$http","$sce",function(a,b,c,d){function e(a){for(var b in a[0].attributes)a[0].attributes[b]?a[0].attributes[b]:delete a[0].attributes[b]}function f(a,b,c,d){for(var e in a)for(var f in b)a[e].attributes[c]===b[f].attributes[c]&&(console.log("Join Fields Match"),a[e].attributes[d]=b[f].attributes[d],delete a[e].attributes[c])}var g="http://gis.raleighnc.gov/asbuilts/PROJECT_TRACKING/";a.documentid=b.documentid,a.doc=a.documentid.split("-"),a.url=d.trustAsResourceUrl(g+a.doc[0]+"/"+a.documentid+".pdf");var h={f:"json",outFields:"*",where:"PROJECTID = "+a.doc[0]+" AND DOCTYPEID = '"+a.doc[1]+"' AND DOCID = "+a.doc[2]},i={f:"json",outFields:"*",where:"OBJECTID > 0"},j="http://mapstest.raleighnc.gov/arcgis/rest/services/PublicUtility/ProjectTracking/FeatureServer/5/query";c.get(j,{params:h,cache:!0}).success(function(b){console.log(b),a.documentDetails=b.features,e(a.documentDetails);var d="http://mapstest.raleighnc.gov/arcgis/rest/services/PublicUtility/ProjectTracking/FeatureServer/9/query";c.get(d,{params:i,cache:!0}).success(function(b){console.log(b),a.doctypes=b.features,f(a.documentDetails,a.doctypes,"DOCTYPEID","DOCUMENTTYPE")})}),a.$watch("documentDetails",function(){console.log(a.documentDetails)},!0)}]);